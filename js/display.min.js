$(document).ready(function(){var d="";var b=parseInt($("#pages").attr("page"));var c=parseInt($("#pages").attr("mode"));getPage(b,c);var a=parseInt($("#pages").attr("max"));$("#previous").click(function(e){b=parseInt($("#pages").attr("page"));a=parseInt($("#pages").attr("max"));if(b-1>0){$("<img>").attr("src","images/icon/heart.gif").addClass("loading").appendTo("#main");getPage(b-1,c);$("#pages").attr("page",b-1)}else{}});$("#next").click(function(e){b=parseInt($("#pages").attr("page"));a=parseInt($("#pages").attr("max"));if(b+1>a){}else{$("<img>").attr("src","images/icon/heart.gif").addClass("loading").appendTo("#main");getPage(b+1,c);$("#pages").attr("page",b+1)}});$("#main").on("click",".ui-icon-like",function(f){var e=$(this).attr("post");$.ajax({url:"php/action.php",type:"POST",dataType:"html",data:{act:"liked",post_id:e}}).done(function(g){console.log("success");if(g!=""){$(f.target).html(g).addClass("ui-icon-liked").fadeIn(300)}}).fail(function(){console.log("error")}).always(function(){console.log("complete")})});$("#main").on("click",".ui-icon-guess",function(g){var e=$(this).attr("post");var h=$(this).text();var f=h.split("/");$("#guess_all").text(f[1]);$("#guess_right").text(f[0]);d=$(this).attr("post");$("#guess-hint").text("")});$("#guess-submit").click(function(f){var e=$("#guess-input").val();if(e!=""){$.ajax({url:"php/action.php",type:"POST",dataType:"html",data:{act:"guess",guessName:e,post_id:d}}).done(function(g){console.log("success");$("#guess-hint").text(g)}).fail(function(){console.log("error")}).always(function(){console.log("complete");$("#guess-input").val("")})}else{}});$("#main").on("click",".ui-icon-comment",function(f){var e=$(this).attr("post");$("#comment-submit").attr("post",e);$("#comment-lists-ul").html("");$.ajax({url:"php/action.php",type:"POST",dataType:"json",data:{act:"getComment",post_id:e}}).done(function(g){console.log("success");console.log(g);commentOutput(g)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})});$("#comment-submit").click(function(f){var g=$("#comment-Popup input").val();var e=$(this).attr("post");if(g!=""){$.ajax({url:"php/action.php",type:"POST",dataType:"html",data:{act:"comment",comment:g,post_id:e}}).done(function(h){console.log("success");console.log(h);$("#comment-hint").text("评论成功！")}).fail(function(){console.log("error")}).always(function(){console.log("complete");$("#comment-Popup input").val("")})}else{}});$("#main").on("click",".ui-icon-share",function(f){var e=$(this).attr("post");$("#link").html("");$("<a>").attr("target","_blank").attr("href","https://pingxonline.com/app/sust/share.php?id="+e).text("https://pingxonline.com/app/sust/share.php?id="+e).appendTo("#link")});$("#returnTop").click(function(){$("body,html").animate({scrollTop:0},500)});$("#new-posts").click(function(e){var f=1;var g=1;getPage(f,g);$("#pages").attr("page",f).attr("mode",g)});$("#old-posts").click(function(e){var f=1;var g=4;getPage(f,g);$("#pages").attr("page",f).attr("mode",g)});$("#most-liked").click(function(e){var f=1;var g=0;getPage(f,g);$("#pages").attr("page",f).attr("mode",g)});$("#less-liked").click(function(e){var f=1;var g=3;getPage(f,g);$("#pages").attr("page",f).attr("mode",g)});$("#random-posts").click(function(e){var f=1;var g=2;getPage(f,g);$("#pages").attr("page",f).attr("mode",g)})});function getPage(a,b){$.ajax({url:"php/action.php",type:"POST",dataType:"json",data:{act:"load",page:a,mode:b}}).done(function(d){console.log("success");output(d);var f=$("#pages").attr("page");var c=$("#pages").attr("max");var e=$("#pages").attr("total");$("#pageNum").text("第"+f+"页，共"+c+"页，共"+e+"条表白")}).fail(function(){console.log("error")}).always(function(){console.log("complete");$("body,html").scrollTop(200)})}function output(a){$("#main").html("");var b="";var c="";$.each(a,function(i,e){var d=e[0];var m=e[1];var n=e[2];var g=e[3];var h=e[4];var o=e[5];var k=e[6];var f=e[7];b=e[8]+1;var l=e[9];var j=e[10];var p=e[11];c=e[12];$("<div>").addClass("post").addClass("post-"+d).appendTo("#main");$("<div>").addClass("post-title").addClass("post-title-"+d).appendTo(".post-"+d);$("<ul>").html('<li class="'+j+'">'+m+'</li><li><img src="images/icon/to.png" alt="" /></li><li class="'+p+'">'+n+"</li>").appendTo(".post-title-"+d);$("<div>").addClass("post-body").addClass("post-body-"+d).appendTo(".post-"+d);$("<p>").addClass("post-body-content").text(g).appendTo(".post-body-"+d);$("<p>").addClass("post-body-time").text(f).appendTo(".post-body-"+d);$("<div>").addClass("post-actions action ui-navbar").addClass("post-actions-"+d).attr("data-role","navbar").attr("role","navigation").appendTo(".post-"+d);$("<ul>").addClass("ui-grid-c").addClass("post-actions-ul-"+d).appendTo(".post-actions-"+d);if(getCookie(d)==d){$("<li>").addClass("ui-block-a").html('<a class="ui-link ui-btn ui-icon-like ui-btn-icon-left ui-icon-liked" href="#" post="'+d+'" data-icon="like">'+h+"</a>").appendTo(".post-actions-ul-"+d)}else{$("<li>").addClass("ui-block-a").html('<a class="ui-link ui-btn ui-icon-like ui-btn-icon-left " href="#" post="'+d+'" data-icon="like">'+h+"</a>").appendTo(".post-actions-ul-"+d)}$("<li>").addClass("ui-block-b").html('<a class="ui-link ui-btn ui-icon-guess ui-btn-icon-left " href="#guess-Name-Popup"  data-rel="popup" data-position-to="window"	data-transition="pop" post="'+d+'" data-icon="guess">'+o+"/"+l+"</a>").appendTo(".post-actions-ul-"+d);$("<li>").addClass("ui-block-c").html('<a class="ui-link ui-btn ui-icon-comment ui-btn-icon-left " href="#comment-Popup" data-rel="popup" data-position-to="window"	data-transition="pop" post="'+d+'" data-icon="comment">'+k+"</a>").appendTo(".post-actions-ul-"+d);$("<li>").addClass("ui-block-d").html('<a class="ui-link ui-btn ui-icon-share ui-btn-icon-left " href="#share-Popup" data-rel="popup" data-position-to="window"	data-transition="pop" post="'+d+'" data-icon="share">分享</a>').appendTo(".post-actions-ul-"+d)});$("#pages").attr("max",b).attr("total",c)}function commentOutput(a){$("#comment-lists-ul").html("");if(a==""){$("#comment-lists-ul").text("快来抢沙发吧！")}else{$.each(a,function(b,c){$("<li>").html('<span class="comment-floor">'+(b+1)+'楼</span><span class="comment-ip">'+c[2]+'</span><span class="comment-time">'+c[0]+"</span><p>"+c[1]+"</p>").appendTo("#comment-lists-ul")})}}function getCookie(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""};